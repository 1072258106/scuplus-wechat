<template>
  <view class="details">
    <view class="header">
      <view class="title">
        <text></text>
      </view>
      <view class="info">
      </view>
    </view>
    <view class="content">
      <htmlParser :parserName="name" :parserContent.sync="content" />
    </view>
    <view wx:if="{{url}}" class="footer">
      <view>
        原文：{{url}}
      </view>
    </view>
  </view>
</template>
<script>
  import wepy from 'wepy'
  import htmlParser from '../components/htmlParser'
  import http from "../util/http";
  export default class Details extends wepy.page {
    config = {}
    components = {
      htmlParser: htmlParser,
    }
    data = {
      title: "",
      content: "",
      name: "123",
      url: ""
    }
    getDetail(id) {
      let self = this
      http.get("/detail/" + id).then(
        resp => {
          if (resp.status == 0) {
            let title = resp.data.title
            if (resp.data.category == "scuinfo") {
              title = resp.data.author
              resp.data.content = resp.data.content.replace(/\n/g, "<br />")
            }
            self.content = resp.data.content
            wepy.setNavigationBarTitle({
              title: title
            })
            self.title = title
            self.url = resp.data.url
            self.$apply()
            self.$invoke('htmlParser', 'htmlParserNotice')
          }
        }
      )
    }
    getNotice(id) {
      let self = this
      http.get("/notice/" + id).then(
        resp => {
          if (resp.status == 0) {
            self.content = resp.data.content
            wepy.setNavigationBarTitle({
              title: resp.data.title
            })
            self.$apply()
            self.$invoke('htmlParser', 'htmlParserNotice')
          }
        }
      )
    }
    async onLoad(option) {
      switch (option.from) {
        case "notice":
          this.getNotice(option.id)
          break;
        default:
          this.getDetail(option.id)
          break;
      }
    }
    onShareAppMessage(options) {
      return {
        title: this.title
      }
    }
  }
</script>
<style lang="less">
  page {
    background: #eee;
  }
  .details {
    margin: 0.2rem;
    padding: 0.5rem;
    background: #fff;
    border: 1px solid #ddd;
    border-radius: 0.1rem;
  }
  .content {
    view {
      line-height: 180% !important;
      font-size: 1rem !important;
    }
  }
  .footer {
    margin-top: 2rem;
    font-size: 0.5rem;
    color: #888;
  }
</style>